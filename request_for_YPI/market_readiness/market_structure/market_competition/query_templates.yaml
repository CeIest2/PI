# ============================================================================
# Query Configuration - MARKET CONCENTRATION (HHI)
# Pillar: Market Readiness / Market Structure
# ============================================================================

queries:
  # --------------------------------------------------------------------------
  # Query 1: ISP Market Share Breakdown
  # --------------------------------------------------------------------------
  "1.cypher":
    description: "Breakdown of Internet Service Providers (AS) by market share (population served)"
    
    # Jinja2 Template for LLM context generation (English)
    template: |
      Title: ISP Market Share Analysis for {{ params.countryCode | upper }}
      
      This query analyzes the structure of the internet access market by identifying Autonomous Systems (AS) and their estimated market share based on population served. A market dominated by one or two large actors suggests high concentration and potential resilience risks (single points of failure).
      
      {% if results %}
      **Market Share Ranking (Top Providers):**
      
      {% for item in results %}
      - **Rank {{ loop.index }}:** {{ item.asName }} (AS{{ item.asn }})
        Estimated Market Share: **{{ "%.2f"|format(item.marketSharePercent) }}%**
      {% endfor %}
      
      {% if results|length > max_display %}
      _({{ results|length - max_display }} other provider(s) omitted from this view)_
      {% endif %}
      
      {% else %}
      No market share data available for ASes in this country.
      {% endif %}

    # Metadata for automatic formatting
    fields:
      asn:
        type: "integer"
        label: "AS Number"
      asName:
        type: "string"
        label: "Provider Name"
      marketSharePercent:
        type: "float"
        label: "Market Share"
        format: "percentage"

    # Display Configuration
    max_display: 10
    sort_by: "marketSharePercent"
    sort_order: "desc"

  # --------------------------------------------------------------------------
  # Query 2: Herfindahl-Hirschman Index (HHI) Calculation
  # --------------------------------------------------------------------------
  "2.cypher":
    description: "Calculation of the HHI index to measure market concentration"
    
    # Jinja2 Template for LLM context generation (English)
    template: |
      Title: Market Concentration Index (HHI) for {{ params.countryCode | upper }}
      
      This metric calculates the Herfindahl-Hirschman Index (HHI), a standard measure of market competition. 
      - **HHI < 1500:** Competitive Market (Good for resilience/pricing).
      - **HHI > 2500:** Highly Concentrated (Monopoly/Oligopoly risks).
      
      {% if results %}
      **Analysis Results:**
      
      - Calculated HHI Score: **{{ "%.0f"|format(results[0].hhi) }}**
      - Market Classification: **{{ results[0].marketConcentration }}**
      
      {% if results[0].hhi > 2500 %}
      *Interpretation:* The market is highly concentrated. This indicates a significant reliance on dominant players, which may negatively impact network resilience and consumer choice.
      {% elif results[0].hhi < 1500 %}
      *Interpretation:* The market appears competitive with no single dominant player holding excessive power.
      {% else %}
      *Interpretation:* The market is moderately concentrated.
      {% endif %}
      
      {% else %}
      Insufficient data to calculate HHI for this country.
      {% endif %}

    # Metadata for automatic formatting
    fields:
      hhi:
        type: "float"
        label: "HHI Score"
        format: "number"
      marketConcentration:
        type: "string"
        label: "Market Status"

    # Display Configuration
    max_display: 1