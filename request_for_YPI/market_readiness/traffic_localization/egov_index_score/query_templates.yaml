# ============================================================================
# Query Configuration - E-GOVERNMENT DEVELOPMENT INDEX (Infrastructure View)
# Pillar: Market Readiness
# ============================================================================

queries:
  # --------------------------------------------------------------------------
  # Query 1: Identification of Key Local Domains (Potential E-Gov Portals)
  # --------------------------------------------------------------------------
  "market_readiness/e_government/1.cypher":
    description: "List of popular domains within the national ccTLD, ranked by local query intensity"
    
    # Jinja2 Template for LLM context generation (English)
    template: |
      Title: Top Locally Accessed Domains (ccTLD) in {{ params.countryCode | upper }}
      
      This analysis identifies the most frequently queried local domains (ending in .{{ params.countryCode | lower }}) from within the country. While not all are government sites, this list highlights the most critical digital services for the local population. Identifying these domains is the first step to analyzing the resilience of the national digital ecosystem.
      
      {% if results %}
      **Most Popular Local Domains:**
      
      {% for item in results %}
      - **Rank {{ loop.index }}:** {{ item.domainName }}
        Local Query Share: **{{ "%.4f"|format(item.percentageOfLocalQueries * 100) }}%**
        {% if item.trancoRank %}
        (Global Tranco Rank: {{ item.trancoRank }})
        {% endif %}
      {% endfor %}
      
      {% if results|length > max_display %}
      _({{ results|length - max_display }} other domain(s) omitted from this view)_
      {% endif %}
      
      {% else %}
      No query data available for local ccTLD domains.
      {% endif %}

    # Metadata for automatic formatting
    fields:
      domainName:
        type: "string"
        label: "Domain Name"
      percentageOfLocalQueries:
        type: "float"
        label: "Local Query %"
        format: "percentage"
      trancoRank:
        type: "integer"
        label: "Global Rank"
        format: "number"

    # Display Configuration
    max_display: 25
    sort_by: "percentageOfLocalQueries"
    sort_order: "desc"

  # --------------------------------------------------------------------------
  # Query 2: Hosting Infrastructure Analysis (Digital Sovereignty)
  # --------------------------------------------------------------------------
  "market_readiness/e_government/2.cypher":
    description: "Analysis of the hosting location (AS and Country) for a specific target domain"
    
    # Jinja2 Template for LLM context generation (English)
    template: |
      Title: Hosting Infrastructure Analysis for {{ params.domainName }}
      
      This query investigates the physical and logical location of the server hosting the domain **{{ params.domainName }}**.
      - **Digital Sovereignty:** Local hosting ensures data remains within national jurisdiction and reduces latency.
      - **Resilience Risk:** Hosting critical government services abroad creates dependencies on international transit and foreign legal frameworks.
      
      {% if results %}
      **Hosting Details:**
      
      {% for item in results %}
      - **Hosting Provider:** {{ item.hostingASName }} (AS{{ item.hostingASN }})
      - **Location:** {{ item.hostingASCountry }}
        
        {% if item.isHostedLocally %}
        ✅ **Status:** LOCALLY HOSTED. This contributes to high digital sovereignty and resilience.
        {% else %}
        ⚠️ **Status:** OFFSHORE HOSTING. This service relies on international infrastructure.
        {% endif %}
      {% endfor %}
      
      {% else %}
      Could not determine the hosting infrastructure for this domain.
      {% endif %}

    # Metadata for automatic formatting
    fields:
      hostingASN:
        type: "integer"
        label: "ASN"
      hostingASName:
        type: "string"
        label: "Provider Name"
      hostingASCountry:
        type: "string"
        label: "Country Code"
      isHostedLocally:
        type: "boolean"
        label: "Hosted Locally"

    # Display Configuration
    max_display: 10

  # --------------------------------------------------------------------------
  # Query 3: Routing Security (RPKI) Assessment
  # --------------------------------------------------------------------------
  "market_readiness/e_government/3.cypher":
    description: "Assessment of RPKI adoption for the Autonomous System hosting the service"
    
    # Jinja2 Template for LLM context generation (English)
    template: |
      Title: Routing Security (RPKI) Status for AS{{ params.hostingASN }}
      
      This metric evaluates the routing hygiene of the Autonomous System hosting the target service.
      - **RPKI Valid:** The provider protects its IP prefixes against BGP hijacking.
      - **RPKI NotFound/Invalid:** The infrastructure is vulnerable to routing attacks, which could make the e-government service unreachable.
      
      {% if results %}
      **RPKI Status Distribution:**
      
      {% for item in results %}
      - **{{ item.rpkiStatus }}:** {{ item.numberOfPrefixes }} prefix(es)
        {% if 'Valid' in item.rpkiStatus %}
        *(Secure)*
        {% else %}
        *(Vulnerable)*
        {% endif %}
      {% endfor %}
      
      {% else %}
      No RPKI data available for this ASN.
      {% endif %}

    # Metadata for automatic formatting
    fields:
      rpkiStatus:
        type: "string"
        label: "RPKI Status"
      numberOfPrefixes:
        type: "integer"
        label: "Prefix Count"
        format: "number"

    # Display Configuration
    max_display: 5
    sort_by: "numberOfPrefixes"
    sort_order: "desc"