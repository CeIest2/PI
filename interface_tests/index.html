<!DOCTYPE html>
<html>
<head>
    <title>OSINT Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Ajout d'un peu de style pour forcer le rendu des titres si Tailwind Typography est capricieux */
        .prose h1 { color: #1e293b !important; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem; }
        .prose h2 { color: #334155 !important; border-top: 1px solid #f1f5f9; pt-4; }
    </style>
</head>
<body class="bg-slate-900 text-white flex h-screen overflow-hidden">

    <div class="w-80 p-6 bg-slate-800 shadow-xl z-10 flex flex-col gap-4 border-r border-slate-700">
        <h1 class="text-xl font-bold border-b border-slate-700 pb-2">üîç Agent Analyst</h1>
        
        <label class="text-xs uppercase text-slate-400 font-bold">Indicateur</label>
        <select id="indicator" class="bg-slate-700 p-2 rounded text-white outline-none focus:ring-2 focus:ring-blue-500">
            <option value="connectivity">Connectivit√©</option>
            <option value="dns">DNS Analysis</option>
        </select>

        <label class="text-xs uppercase text-slate-400 font-bold">Pays (Auto-detect)</label>
        <input id="country" value="FR" class="bg-slate-700 p-2 rounded text-blue-400 font-bold outline-none" readonly>

        <button onclick="startAgent()" id="btn" class="mt-4 bg-blue-600 hover:bg-blue-500 p-3 rounded font-bold transition shadow-lg active:scale-95">
            Lancer l'Analyse Agentique
        </button>
        
        <div id="loader" class="hidden text-sm text-blue-300 animate-pulse text-center mt-4">
            ü§ñ L'agent travaille... <br> 
            <span class="text-xs text-slate-500">(OSINT & R√©daction)</span>
        </div>
    </div>

    <div class="flex-1 bg-white h-full overflow-y-auto">
        <div id="report" class="p-12 prose prose-slate max-w-none text-slate-900
            [&_*]:text-slate-900 
            [&_h1]:text-4xl [&_h1]:font-black [&_h1]:mb-8 [&_h1]:border-none
            [&_h2]:text-2xl [&_h2]:font-bold [&_h2]:mt-10 [&_h2]:mb-4
            [&_p]:leading-relaxed
            [&_hr]:my-10 [&_hr]:border-slate-200">
            <p class="text-slate-400 italic">Le rapport s'affichera ici apr√®s l'analyse...</p>
        </div>
    </div>

    <script>
        async function startAgent() {
            const btn = document.getElementById('btn');
            const loader = document.getElementById('loader');
            const reportDiv = document.getElementById('report');

            btn.disabled = true;
            loader.classList.remove('hidden');
            reportDiv.innerHTML = '<p class="text-blue-500 animate-pulse">G√©n√©ration du rapport en cours...</p>';

            try {
                const res = await fetch('http://localhost:8000/run-analysis', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        indicator: document.getElementById('indicator').value,
                        country: document.getElementById('country').value,
                        domain: "gouv.fr",
                        asn: 16276
                    })
                });
                
                const data = await res.json();
                
                // Utilisation de Marked avec options pour s'assurer que le rendu est propre
                reportDiv.innerHTML = marked.parse(data.report); 
                
            } catch (e) {
                reportDiv.innerHTML = `<p class="text-red-500 font-bold">‚ùå Erreur serveur : ${e.message}</p>`;
            } finally {
                btn.disabled = false;
                loader.classList.add('hidden');
            }
        }
    </script>
</body>
</html>